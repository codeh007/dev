{
  "name": "GoMTM Dev Environment",
  "image": "docker.io/gitgit188/gomtm:v0.8.1775",
  "privileged": true,
  "remoteUser": "code",

  "features": {
    "ghcr.io/devcontainers/features/docker-in-docker:2": {
      "version": "latest",
      "dockerDashComposeVersion": "v2"
    }
  },

  // ç¡®ä¿æ²¡æœ‰æŒ‚è½½å®¿ä¸»æœºç›®å½•è¦†ç›–å®¹å™¨å†…çš„è·¯å¾„
  "mounts": [],

  "hostRequirements": {
    "cpus": 4
  },

  "overrideCommand": true,
  "command": ["sleep", "infinity"],

  "customizations": {
    "vscode": {
      "settings": {
        "terminal.integrated.defaultProfile.linux": "bash"
      }
    }
  },

  // ðŸš€ ç»ˆæžä¿®æ­£ç‰ˆ postStartCommand
  // é€»è¾‘ï¼š
  // 1. åˆ¤æ–­æ˜¯å¦å·²ç»æ˜¯è½¯è¿žæŽ¥ï¼Œå¦‚æžœæ˜¯åˆ™è·³è¿‡ã€‚
  // 2. ä¿®æ­£ PID ä»¥ä¾¿ service å‘½ä»¤èƒ½æŽ§åˆ¶ã€‚
  // 3. åœæ­¢ Dockerã€‚
  // 4. å°† /var/lib/docker çš„çŽ°æœ‰æ•°æ®(å«è¯ä¹¦)å®Œæ•´ç§»åŠ¨åˆ° /tmp/docker-rootã€‚
  // 5. åˆ é™¤åŽŸç›®å½•ï¼Œå»ºç«‹ä»Ž /var/lib/docker åˆ° /tmp/docker-root çš„è½¯è¿žæŽ¥ã€‚
  // 6. å¯åŠ¨ Docker (æ­¤æ—¶å®ƒä»¥ä¸ºè‡ªå·±è¿˜åœ¨å†™ /var/lib/dockerï¼Œå®žé™…ä¸Šåœ¨ /tmp)ã€‚
  "postStartCommand": "sudo bash -c 'if [ ! -L \"/var/lib/docker\" ]; then echo \"âš™ï¸ Migrating Docker to /tmp via Symlink...\"; echo $(pidof dockerd) > /var/run/docker-ssd.pid; service docker stop; while pidof dockerd >/dev/null; do sleep 1; done; mkdir -p /tmp/docker-root; cp -a /var/lib/docker/. /tmp/docker-root/; rm -rf /var/lib/docker; ln -s /tmp/docker-root /var/lib/docker; service docker start; while ! docker info >/dev/null 2>&1; do sleep 1; done; echo \"âœ… Migration done.\"; else echo \"âœ… Already migrated.\"; fi' && sudo nohup gomtm entrypoint --mtgate-url=https://mtgateapi.yuepa8.com > /tmp/gomtm-start.log 2>&1 &",

  "postAttachCommand": "gomtm upgrade && gomtm install --dev"
}
