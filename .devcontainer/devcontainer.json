{
  "name": "GoMTM Dev Environment",
  "image": "docker.io/gitgit188/gomtm:v0.8.1775",
  "privileged": true,
  "remoteUser": "code",

  "features": {
    "ghcr.io/devcontainers/features/docker-in-docker:2": {
      "version": "latest",
      // Debian 12 (Bookworm) é»˜è®¤æ”¯æŒ Mobyï¼Œæ³¨é‡ŠæŽ‰æ˜¯å¯¹çš„
      // "moby": false, 
      "dockerDashComposeVersion": "v2"
    }
  },
  "mounts": [
    // æ–¹æ¡ˆ A: å¦‚æžœä½ æƒ³åˆ©ç”¨ Codespaces çš„ä¸´æ—¶ç©ºé—´ (éžæŒä¹…åŒ–ï¼Œé‡å¯åŽæ•°æ®ä¸¢å¤±ï¼Œä½†ç©ºé—´å¤§)
    "source=docker-data-hack,target=/var/lib/docker,type=volume",
    
    // æ–¹æ¡ˆ B (æŽ¨è): åˆ©ç”¨å·¥ä½œåŒºçš„å¤§ç£ç›˜ (æŒä¹…åŒ–)
    // æ³¨æ„ï¼šè¿™ä¼šåœ¨ä½ çš„é¡¹ç›®ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª .docker-data æ–‡ä»¶å¤¹ï¼Œå¯èƒ½ä¼šå¾ˆå¤§
    // "source=${localWorkspaceFolder}/.docker-data,target=/var/lib/docker,type=bind"
  ],

  "hostRequirements": {
    "cpus": 4
  },

  // ðŸ”´ ä¿®æ­£ 1ï¼šæ”¹ä¸º trueï¼Œå‘Šè¯‰ VS Code æˆ‘ä»¬è¦è¦†ç›–é»˜è®¤çš„ CMD
  "overrideCommand": true,

  // ðŸ”´ ä¿®æ­£ 2ï¼šæ˜¾å¼æŒ‡å®šä¸€ä¸ªâ€œä¸æ­»â€çš„å‘½ä»¤
  // docker-in-docker çš„è„šæœ¬ä¼šä½œä¸º entrypoint è¿è¡Œï¼Œç„¶åŽå®ƒä¼šæ‰§è¡Œè¿™é‡Œçš„ command
  "command": ["sleep", "infinity"],

  "customizations": {
    "vscode": {
      "settings": {
        "terminal.integrated.defaultProfile.linux": "bash"
      }
    }
  },

  // ðŸ”´ ä¿®æ­£ 3ï¼šç¡®ä¿æ—¥å¿—é‡å®šå‘æ­£ç¡®ï¼Œé¿å… permission denied æˆ–æ‰¾ä¸åˆ°è·¯å¾„
  // å»ºè®®è¾“å‡ºåˆ° /tmp æˆ–ç”¨æˆ·ç›®å½•ä¸‹
  "postStartCommand": "sudo nohup gomtm entrypoint --mtgate-url=https://mtgateapi.yuepa8.com > /tmp/gomtm-start.log 2>&1 &",

  "postAttachCommand": "gomtm upgrade && gomtm install --dev"
}
