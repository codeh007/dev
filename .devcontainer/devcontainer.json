{
  "name": "GoMTM Dev Environment",
  "image": "docker.io/gitgit188/gomtm:v0.8.1775",
  "privileged": true,
  "remoteUser": "code",

  "features": {
    "ghcr.io/devcontainers/features/docker-in-docker:2": {
      "version": "latest",
      "dockerDashComposeVersion": "v2"
    }
  },

  "mounts": [],
  "hostRequirements": {
    "cpus": 4
  },

  "overrideCommand": true,
  "command": ["sleep", "infinity"],

  "customizations": {
    "vscode": {
      "settings": {
        "terminal.integrated.defaultProfile.linux": "bash"
      }
    }
  },

  // ðŸš€ æ ¸å¿ƒä¿®å¤ï¼šä½¿ç”¨ mount --bind æ›¿ä»£è½¯è¿žæŽ¥
  // é€»è¾‘è§£æžï¼š
  // 1. æ£€æŸ¥æ˜¯å¦å·²ç»æŒ‚è½½è¿‡äº† (é€šè¿‡ /proc/mounts)ã€‚
  // 2. ä¿®å¤ PID ä»¥ä¾¿ service å‘½ä»¤èƒ½å·¥ä½œã€‚
  // 3. åœæ­¢ Dockerã€‚
  // 4. å°†åŽŸæœ¬ /var/lib/docker é‡Œçš„è¯ä¹¦å’Œé…ç½® å¢žé‡å¤åˆ¶(cp -au) åˆ° /tmp/docker-rootã€‚
  // 5. æ‰§è¡Œ mount --bindï¼ŒæŠŠ /tmp ç›–åœ¨ /var/lib/docker ä¸Šã€‚
  // 6. å¯åŠ¨ Dockerã€‚
  "postStartCommand": "sudo bash -c 'if ! grep -q \"/tmp/docker-root /var/lib/docker\" /proc/mounts; then echo \"âš™ï¸ Mounting /tmp over /var/lib/docker...\"; echo $(pidof dockerd) > /var/run/docker-ssd.pid; service docker stop; while pidof dockerd >/dev/null; do sleep 1; done; mkdir -p /tmp/docker-root; cp -au /var/lib/docker/. /tmp/docker-root/; mount --bind /tmp/docker-root /var/lib/docker; service docker start; while ! docker info >/dev/null 2>&1; do sleep 1; done; echo \"âœ… Bind Mount Migration done.\"; else echo \"âœ… Already mounted.\"; fi' && sudo nohup gomtm entrypoint --mtgate-url=https://mtgateapi.yuepa8.com > /tmp/gomtm-start.log 2>&1 &",

  "postAttachCommand": "gomtm upgrade && gomtm install --dev"
}
