{
  "name": "GoMTM Dev Environment",
  "image": "docker.io/gitgit188/gomtm:v0.8.1775",
  "privileged": true,
  "remoteUser": "code",

  "features": {
    "ghcr.io/devcontainers/features/docker-in-docker:2": {
      "version": "latest",
      "dockerDashComposeVersion": "v2"
    }
  },

  "mounts": [],
  "hostRequirements": {
    "cpus": 4
  },

  "overrideCommand": true,
  "command": ["sleep", "infinity"],

  "customizations": {
    "vscode": {
      "settings": {
        "terminal.integrated.defaultProfile.linux": "bash"
      }
    }
  },

  // ðŸš€ æœ€ç»ˆæ ¸å¿ƒä¿®å¤ï¼šå¸è½½ (Umount) -> è½¯è¿žæŽ¥
  // é€»è¾‘è§£æžï¼š
  // 1. æ£€æŸ¥ /var/lib/docker æ˜¯å¦è¿˜æ˜¯ä¸€ä¸ªæŒ‚è½½ç‚¹ (mountpoint -q)ã€‚
  // 2. ä¿®å¤ PID ä»¥ä¾¿ service å‘½ä»¤èƒ½å·¥ä½œã€‚
  // 3. åœæ­¢ Dockerã€‚
  // 4. ã€å…³é”®ã€‘æ‰§è¡Œ umount /var/lib/dockerã€‚è¿™ä¸€æ­¥å½»åº•æ–­å¼€äº†ä¸Ž 32GB ç£ç›˜çš„è¿žæŽ¥ã€‚
  // 5. åˆ é™¤æ®‹ç•™ç›®å½•ï¼Œå»ºç«‹æŒ‡å‘ /tmp/docker-root çš„è½¯è¿žæŽ¥ã€‚
  // 6. å¯åŠ¨ Dockerã€‚
  "postStartCommand": "sudo bash -c 'if mountpoint -q /var/lib/docker; then echo \"âš™ï¸ Unmounting and linking to /tmp...\"; echo $(pidof dockerd) > /var/run/docker-ssd.pid; service docker stop; while pidof dockerd >/dev/null; do sleep 1; done; umount /var/lib/docker; rm -rf /var/lib/docker; mkdir -p /tmp/docker-root; ln -s /tmp/docker-root /var/lib/docker; service docker start; while ! docker info >/dev/null 2>&1; do sleep 1; done; echo \"âœ… Migration done.\"; else echo \"âœ… Already migrated.\"; fi' && sudo nohup gomtm entrypoint --mtgate-url=https://mtgateapi.yuepa8.com > /tmp/gomtm-start.log 2>&1 &",

  "postAttachCommand": "gomtm upgrade && gomtm install --dev"
}
