{
  "name": "GoMTM Dev Environment",
  // 这里直接指向你刚刚构建好的镜像 URL
  // 注意：如果你 fork 了仓库，这里的 codeh007 需要改成你的用户名，或者保持动态
  //"image": "ghcr.io/codeh007/dev:latest",
  "image": "docker.io/gitgit188/gomtm@sha256:5982ecbf33fcb7dfc802ae1c2e2c776466586428ce8830449e75ae284aa76711",
  
  // "build": { ... },
  "features": {
    "ghcr.io/devcontainers/features/docker-in-docker:2": {
      "version": "latest",
      // 提示： 由于 镜像使用了交新的 debian 版本，导致不支持moby
      "moby": false,
      "enableNonRootDocker": "true"
    }
  },
  "hostRequirements": {
    "cpus": 4
  },
  "privileged": true,
  //提示： 应当跟容器内置的用户名对应，否则会出错。
  "remoteUser": "code",
  // 覆盖容器的默认启动行为
  // 1. 使用 gomtm entrypoint 作为入口
  // 2. 传递 --mtgate-url 参数以触发服务器后台启动
  // 3. "--" 后面跟随的是最终要执行的 Shell (通常 VS Code 会自动附加，但显式指定更安全)
  "overrideCommand": true,
  "customizations": {
    "vscode": {
      "settings": {
        "terminal.integrated.defaultProfile.linux": "bash"
      }
    }
  },
  
  // 这里定义的命令会作为 PID 1 (或其子进程) 运行
  // 结构: [主程序, 子命令, 参数..., --, 最终Shell]
  "entrypoint": [
    "gomtm", 
    "entrypoint", 
    "--mtgate-url=https://mtgateapi.yuepa8.com", 
    "--", 
    "/bin/bash",
    "-c",
    "sleep infinity" 
  ],

  // 可选：连接后自动在一个终端 Split 中 tail 日志，或者只是运行一次提示
  "postAttachCommand": "echo 'Checking gomtm server logs...'; tail -n 10 /tmp/gomtm-server.log"
}
