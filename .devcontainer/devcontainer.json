{
  "name": "GoMTM Dev Environment",
  "image": "docker.io/gitgit188/gomtm:v0.8.1740",
  "privileged": true,
  "remoteUser": "code",

  "features": {
    "ghcr.io/devcontainers/features/docker-in-docker:2": {
      "version": "latest",
      // 必须加回 false，因为你的镜像被识别为 Debian Trixie
      "moby": false, 
      "dockerDashComposeVersion": "v2"
    }
  },

  "hostRequirements": {
    "cpus": 4
  },

  // 重要：保持为 false 或删除此行，允许 VS Code 处理命令
  "overrideCommand": false,

  // !!! 绝对不要解开这个注释 !!!
  // 保留注释状态，让 docker-in-docker 的初始化脚本作为 PID 1 运行
  // 这样才能修复权限问题
  // "entrypoint": [ ... ],

  "customizations": {
    "vscode": {
      "settings": {
        "terminal.integrated.defaultProfile.linux": "bash"
      }
    }
  },

  // 使用 postStartCommand 启动你的 gomtm
  // 这里的命令会在 docker 初始化完成后执行
  "postStartCommand": "sudo nohup gomtm entrypoint --mtgate-url=https://mtgateapi.yuepa8.com > /tmp/gomtm.log 2>&1 &",

  "postAttachCommand": "gomtm upgrade && gomtm install --dev"
}
